# Как применить RLS-политики в Supabase

После выката приложения нужно применить обновлённую схему и политики RLS в вашем проекте Supabase.

## Шаги

1. Откройте [Supabase Dashboard](https://supabase.com/dashboard) и выберите ваш проект.

2. В левом меню откройте **SQL Editor** (или **Database** → **SQL Editor**).

3. Нажмите **New query** (Новый запрос).

4. Откройте файл `supabase-schema-games.sql` в корне репозитория, скопируйте **весь** его содержимое и вставьте в редактор запроса.

5. Нажмите **Run** (или **Ctrl+Enter** / **Cmd+Enter**).

6. Убедитесь, что запрос выполнился без ошибок (внизу появится сообщение об успешном выполнении).

## Что делает скрипт

- Создаёт таблицы `games` и `game_players`, если их ещё нет.
- Включает Row Level Security (RLS) для обеих таблиц.
- Удаляет старые открытые политики (`games_public_rw`, `game_players_public_rw`), если они были.
- Создаёт новые политики, привязанные к `auth.uid()`: только авторизованные пользователи могут создавать игры и присоединяться; читать и обновлять игру могут только её участники (для игр в статусе `waiting` чтение разрешено всем авторизованным для отображения страницы присоединения).

## Если таблицы уже есть и в них есть данные

Скрипт использует `create table if not exists` и только меняет политики — данные не удаляются. Старые политики удаляются, новые создаются поверх текущих таблиц.

## Обновление доски без перезагрузки страницы (Realtime)

Чтобы ходы соперника отображались без обновления страницы, включите Realtime для таблицы `games`:

1. В Supabase Dashboard: **Database** → **Replication** → публикация **supabase_realtime** → включите таблицу **games**.
2. Либо один раз в SQL Editor выполните: `alter publication supabase_realtime add table public.games;`

Если Realtime не включён, приложение всё равно обновляет доску каждые ~1,5 с (polling), пока вы ждёте ход соперника.
